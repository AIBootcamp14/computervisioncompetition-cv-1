# 🛠️ 문제 해결 가이드

## 🚨 자주 발생하는 문제들

### 1. GPU 메모리 부족 (CUDA Out of Memory)

#### 해결 방법
```bash
# 1) 현재 GPU 상태 확인
nvidia-smi

# 2) 메모리 정리
python -c "import torch; torch.cuda.empty_cache(); print('메모리 정리 완료')"

# 3) 작은 배치 크기로 재시작
python src/utils/auto_batch_size.py --config configs/train.yaml --test-only
```

### 2. 모델 파일을 찾을 수 없음

#### 해결 방법
```bash
# 1) 사용 가능한 모델 확인
find experiments/train -name "*.pth" | head -5

# 2) 최신 모델 자동 선택
LATEST=$(find experiments/train -name "best_fold0.pth" | sort | tail -1)
echo "최신 모델: $LATEST"

# 3) 모델 경로 직접 지정
python src/inference/infer_main.py \
    --config configs/infer.yaml \
    --ckpt $LATEST
```

### 3. 학습이 진행되지 않음

#### 해결 방법
```bash
# 1) 로그 확인
tail -20 logs/$(date +%Y%m%d)/train/*.log

# 2) 데이터 경로 확인
ls -la data/raw/train/ | head -5
ls -la data/raw/test/ | head -5

# 3) 환경 재설정
eval "$(pyenv init --path)" && pyenv activate cv_py3_11_9
pip install -r requirements.txt
```

### 4. 설정 파일 오류

#### 해결 방법
```bash
# 1) YAML 문법 확인
python -c "import yaml; yaml.safe_load(open('configs/train.yaml'))"

# 2) 기본 설정으로 초기화
cp configs/train.yaml.backup configs/train.yaml  # 백업이 있는 경우

# 3) 설정 날짜 업데이트
python src/utils/update_config_dates.py
```

## 📊 성능 문제

### 성능이 예상보다 낮을 때

#### 해결 방법
```bash
# 1) 데이터 검증
python -c "
import pandas as pd
df = pd.read_csv('data/raw/train.csv')
print(f'데이터 크기: {len(df)}')
print(f'클래스 분포:\n{df.iloc[:, 1].value_counts()}')
"

# 2) 하이퍼파라미터 최적화
python src/training/train_main.py \
    --config configs/train.yaml \
    --optimize \
    --n-trials 10

# 3) 검증된 설정 사용
python src/training/train_main.py --config configs/train.yaml --mode basic
```

### 학습이 너무 느릴 때

#### 해결 방법
```bash
# 1) GPU 성능 확인
python src/utils/team_gpu_check.py

# 2) 배치 크기 최적화
python src/utils/auto_batch_size.py --config configs/train.yaml

# 3) 빠른 설정 사용
python src/training/train_main.py --config configs/train_fast.yaml --mode basic
```

## 🔧 환경 문제

### Python 환경 문제

#### 해결 방법
```bash
# 1) Python 버전 확인
python3 --version  # 3.11.9 필요

# 2) 가상환경 재설정
pyenv deactivate
pyenv activate cv_py3_11_9

# 3) 의존성 재설치
pip install -r requirements.txt --force-reinstall
```

### CUDA 환경 문제

#### 해결 방법
```bash
# 1) CUDA 버전 확인
nvidia-smi
nvcc --version

# 2) PyTorch CUDA 호환성 확인
python -c "
import torch
print(f'PyTorch: {torch.__version__}')
print(f'CUDA available: {torch.cuda.is_available()}')
print(f'CUDA version: {torch.version.cuda}')
"

# 3) PyTorch 재설치 (필요시)
pip uninstall torch torchvision
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu121
```

## 📋 로그 분석

### 로그 파일 위치
```bash
# 최신 로그 확인
ls -la logs/$(date +%Y%m%d)/

# 학습 로그
tail -f logs/$(date +%Y%m%d)/train/*.log

# 추론 로그
tail -f logs/$(date +%Y%m%d)/infer/*.log
```

### 오류 패턴 찾기
```bash
# GPU 메모리 오류
grep -i "out of memory\|cuda\|memory" logs/$(date +%Y%m%d)/*/*.log

# 파일 경로 오류
grep -i "not found\|no such file" logs/$(date +%Y%m%d)/*/*.log

# 성능 지표
grep -i "f1\|accuracy\|loss" logs/$(date +%Y%m%d)/*/*.log
```

## 🆘 긴급 복구

### 모든 것이 작동하지 않을 때
```bash
# 1) 기본 테스트
python -c "
import torch, pandas, numpy
print('✅ 기본 라이브러리 정상')
print(f'GPU: {torch.cuda.is_available()}')
"

# 2) 최소 설정으로 테스트
python src/training/train_main.py --config configs/train.yaml --mode basic --epochs 1

# 3) 전체 환경 재구성
# (필요시 README.md의 환경 설정 섹션 참조)
```
